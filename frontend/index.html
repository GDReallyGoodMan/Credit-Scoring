<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Credit — Predict Default</title>
<style>
  body{font-family:Inter,Arial,Helvetica,sans-serif;background:#f6f8fb;margin:0;padding:24px}
  .wrap{max-width:820px;margin:0 auto}
  .card{background:#fff;padding:20px;border-radius:10px;box-shadow:0 8px 30px rgba(12,24,48,0.06)}
  h2{margin-top:0}
  form{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  label{font-size:13px;color:#111;margin-bottom:6px;display:block}
  input,select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;background:#fff}
  .full{grid-column:1/-1}
  button{grid-column:1/-1;padding:12px;border-radius:8px;border:0;background:#2563eb;color:#fff;font-weight:600;cursor:pointer}
  #result{margin-top:12px;padding:12px;border-radius:8px;display:none}
  @media(max-width:900px){form{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h2>Проверка заявки — вероятность дефолта</h2>
    <p style="color:#6b7280">Заполни поля — модель оценит вероятность дефолта.</p>

    <form id="loanForm">
      <div>
        <label>Возраст (age)</label>
        <input name="age" type="number" min="18" value="30" />
      </div>

      <div>
        <label>Кол-во отказов/аппликаций (appl_rej_cnt)</label>
        <input name="appl_rej_cnt" type="number" value="0" />
      </div>

      <div>
        <label>Score_bki</label>
        <input name="Score_bki" type="number" step="0.01" value="600" />
      </div>

      <div>
        <label>out_request_cnt</label>
        <input name="out_request_cnt" type="number" value="0" />
      </div>

      <div>
        <label>region_rating (1..5)</label>
        <input name="region_rating" type="number" min="0" value="3" />
      </div>

      <div>
        <label>home_address_cd (код района)</label>
        <input name="home_address_cd" type="text" placeholder="1" />
      </div>

      <div>
        <label>work_address_cd (код района)</label>
        <input name="work_address_cd" type="text" placeholder="1" />
      </div>

      <div>
        <label>Доход (income)</label>
        <input name="income" type="number" step="0.01" value="50000" />
      </div>

      <div>
        <label>first_time_cd (код: 0/1)</label>
        <input name="first_time_cd" type="text" placeholder="0" />
      </div>

      <div>
        <label>Образование (education)</label>
        <select name="education">
          <option value="">—</option>
          <option value="ACD">ACD</option>
          <option value="GRD">GRD</option>
          <option value="NONE">NONE</option>
          <option value="PGR">PGR</option>
          <option value="SCH">SCH</option>
          <option value="UGR">UGR</option>
        </select>
      </div>

      <div>
        <label>Есть машина? (car_own)</label>
        <select name="car_own">
          <option value="">—</option>
          <option value="Y">Да</option>
          <option value="N">Нет</option>
        </select>
      </div>

      <div>
        <label>Тип машины (car_type) — больше/меньше 3.000.000₽? (Y/N)</label>
        <select name="car_type">
          <option value="">—</option>
          <option value="Y">Y</option>
          <option value="N">N</option>
        </select>
      </div>

      <div>
        <label>Air_flg (Y если есть)</label>
        <select name="air">
          <option value="">—</option>
          <option value="Y">Y</option>
          <option value="N">N</option>
        </select>
      </div>

      <div class="full">
        <button type="submit">Оценить вероятность</button>
      </div>
    </form>

    <div id="result"></div>
  </div>
</div>

<script>
const BACKEND = "http://127.0.0.1:8000/predict";
const form = document.getElementById('loanForm');
const resultBox = document.getElementById('result');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  resultBox.style.display = 'none';

  const raw = Object.fromEntries(new FormData(form).entries());
  const payload = {};

  // Приводим числовые поля
  const numericKeys = ['age','appl_rej_cnt','Score_bki','out_request_cnt','region_rating','income'];
  for (const k of numericKeys) {
    if (raw[k] !== undefined && raw[k] !== "") payload[k] = Number(raw[k]);
  }
  // остальные (кодовые/строковые)
  const maybeString = ['home_address_cd','work_address_cd','first_time_cd'];
  for (const k of maybeString) {
    if (raw[k] !== undefined && raw[k] !== "") payload[k] = raw[k];
  }
  // one-hot selects: send single choice
  if (raw.education) payload.education = raw.education;
  if (raw.car_own) payload.car_own = raw.car_own;
  if (raw.car_type) payload.car_type = raw.car_type;
  if (raw.air) payload.air = raw.air;

  try {
    const resp = await fetch(BACKEND, {
      method: "POST",
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(payload)
    });
    const json = await resp.json();
    if (!resp.ok) throw new Error(JSON.stringify(json));

    const pred = json.prediction;
    const prob = (json.probability*100).toFixed(2);
    let bg="#ecfdf5", color="#15803d";
    if (pred === 1) { bg="#fee2e2"; color="#9b1c1c"; } 
    resultBox.style.display='block';
    resultBox.style.background = bg;
    resultBox.style.color = color;
    resultBox.innerHTML = `<strong>${json.message}</strong><div style="margin-top:8px;"><small>Вероятность дефолта: ${prob}% (порог ${Number(json.threshold).toFixed(3)})</small></div>`;
  } catch (err) {
    resultBox.style.display='block';
    resultBox.style.background = "#fee2e2";
    resultBox.style.color = "#9b1c1c";
    resultBox.innerText = "Ошибка: " + err;
  }
});
</script>
</body>
</html>
