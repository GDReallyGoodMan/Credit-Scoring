<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Заявка на кредит</title>
<style>
  body{font-family:Inter,Arial,Helvetica,sans-serif;background:#f6f8fb;margin:0;padding:24px}
  .wrap{max-width:980px;margin:0 auto}
  .card{background:#fff;padding:20px;border-radius:10px;box-shadow:0 8px 30px rgba(12,24,48,0.06)}
  h2{margin-top:0}
  form{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  label{font-size:13px;color:#111;margin-bottom:6px;display:block}
  input,select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;background:#fff}
  .hint{font-size:12px;color:#6b7280;margin-top:6px}
  .full{grid-column:1/-1}
  button{grid-column:1/-1;padding:12px;border-radius:8px;border:0;background:#2563eb;color:#fff;font-weight:600;cursor:pointer}
  #result{margin-top:12px;padding:12px;border-radius:8px;display:none}
  .danger{background:#fee2e2;color:#9b1c1c}
  .warn{background:#fff4e5;color:#b45309}
  .ok{background:#ecfdf5;color:#15803d}
  @media(max-width:900px){form{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h2>Онлайн заявка на кредит</h2>
    <p class="hint">Заполните форму — мы сразу вернём решение по заявке.</p>

    <form id="loanForm">
      <!-- Month: categorical в модели — отправляем как строку (value numeric) -->
      <div>
        <label>Месяц (Month)</label>
        <select name="Month">
          <option value="">—</option>
          <option value="1">1 — Январь</option>
          <option value="2">2 — Февраль</option>
          <option value="3">3 — Март</option>
          <option value="4">4 — Апрель</option>
          <option value="5">5 — Май</option>
          <option value="6">6 — Июнь</option>
          <option value="7">7 — Июль</option>
          <option value="8">8 — Август</option>
          <option value="9">9 — Сентябрь</option>
          <option value="10">10 — Октябрь</option>
          <option value="11">11 — Ноябрь</option>
          <option value="12">12 — Декабрь</option>
        </select>
      </div>

      <div>
        <label>ФИО / Имя (Name)</label>
        <input name="Name" type="text" placeholder="Иван Иванов" />
      </div>

      <div>
        <label>Возраст (Age)</label>
        <input name="Age" type="number" min="18" placeholder="30" />
      </div>

      <div>
        <label>SSN (последние 4 цифры)</label>
        <input name="SSN" type="text" placeholder="1234" />
      </div>

      <div>
        <label>Род деятельности (Occupation)</label>
        <select name="Occupation">
          <option value="">—</option>
          <option value="Employed">Наёмный работник</option>
          <option value="Self-employed">Самозанятый</option>
          <option value="Unemployed">Безработный</option>
          <option value="Student">Студент</option>
          <option value="Retired">Пенсионер</option>
        </select>
      </div>

      <div>
        <label>Годовой доход (Annual_Income)</label>
        <input name="Annual_Income" type="number" step="0.01" placeholder="50000" />
      </div>

      <div>
        <label>Кол-во банковских счетов (Num_Bank_Accounts)</label>
        <input name="Num_Bank_Accounts" type="number" placeholder="2" />
      </div>

      <div>
        <label>Кол-во кредитных карт (Num_Credit_Card)</label>
        <input name="Num_Credit_Card" type="number" placeholder="1" />
      </div>

      <div>
        <label>Процентная ставка (%) (Interest_Rate)</label>
        <input name="Interest_Rate" type="number" step="0.01" placeholder="5.5" />
      </div>

      <div>
        <label>Кол-во текущих займов (Num_of_Loan)</label>
        <input name="Num_of_Loan" type="number" placeholder="0" />
      </div>

      <div>
        <label>Тип займа (Type_of_Loan)</label>
        <select name="Type_of_Loan">
          <option value="">—</option>
          <option value="Personal">Потребительский</option>
          <option value="Home">Ипотека</option>
          <option value="Auto">Автокредит</option>
          <option value="Education">Образование</option>
          <option value="Business">Бизнес</option>
        </select>
      </div>

      <div>
        <label>Задержка по платежу (дней) (Delay_from_due_date)</label>
        <input name="Delay_from_due_date" type="number" placeholder="0" />
      </div>

      <div>
        <label>Кол-во просроченных платежей (Num_of_Delayed_Payment)</label>
        <input name="Num_of_Delayed_Payment" type="number" placeholder="0" />
      </div>

      <div>
        <label>Изменение кредитного лимита (Changed_Credit_Limit)</label>
        <input name="Changed_Credit_Limit" type="number" step="0.01" placeholder="0" />
      </div>

      <div>
        <label>Кол-во запросов в кредитные организации (Num_Credit_Inquiries)</label>
        <input name="Num_Credit_Inquiries" type="number" placeholder="0" />
      </div>

      <div>
        <label>Кредитный портфель (Credit_Mix)</label>
        <select name="Credit_Mix">
          <option value="">—</option>
          <option value="Excellent">Отличный</option>
          <option value="Good">Хороший</option>
          <option value="Standard">Средний</option>
          <option value="Poor">Плохой</option>
        </select>
      </div>

      <div>
        <label>Непогашенная задолженность (Outstanding_Debt)</label>
        <input name="Outstanding_Debt" type="number" step="0.01" placeholder="0" />
      </div>

      <div>
        <label>Коэффициент использования кредита (%) (Credit_Utilization_Ratio)</label>
        <input name="Credit_Utilization_Ratio" type="number" step="0.01" placeholder="30" />
      </div>

      <div>
        <label>Оплата минимального платежа (Payment_of_Min_Amount)</label>
        <select name="Payment_of_Min_Amount">
          <option value="">—</option>
          <option value="Yes">Да</option>
          <option value="No">Нет</option>
          <option value="Sometimes">Иногда</option>
        </select>
      </div>

      <div>
        <label>Общая EMI в мес. (Total_EMI_per_month)</label>
        <input name="Total_EMI_per_month" type="number" step="0.01" placeholder="0" />
      </div>

      <div>
        <label>Сумма инвестиций в мес. (Amount_invested_monthly)</label>
        <input name="Amount_invested_monthly" type="number" step="0.01" placeholder="0" />
      </div>

      <div>
        <label>Платёжное поведение (Payment_Behaviour)</label>
        <select name="Payment_Behaviour">
          <option value="">—</option>
          <option value="Pays_On_Time">Платит вовремя</option>
          <option value="Pays_Minimum">Платит минимум</option>
          <option value="Delayed_Often">Часто задерживает</option>
          <option value="No_Payments">Не платит</option>
        </select>
      </div>

      <div>
        <label>Ежемесячный баланс (Monthly_Balance)</label>
        <input name="Monthly_Balance" type="number" step="0.01" placeholder="1000" />
      </div>

      <div>
        <label>Лет кредитной истории (Credit_History_Years)</label>
        <input name="Credit_History_Years" type="number" placeholder="5" />
      </div>

      <div class="full">
        <label>Месяцев кредитной истории (Credit_History_Months)</label>
        <input name="Credit_History_Months" type="number" min="0" max="11" placeholder="0" />
      </div>

      <div class="full">
        <button type="submit">Отправить и получить решение</button>
      </div>
    </form>

    <div id="result"></div>
  </div>
</div>

<script>
const BACKEND = "http://127.0.0.1:8000/predict";
const form = document.getElementById('loanForm');
const resultBox = document.getElementById('result');

// эти поля — категориальные в модели, не конвертируем их в Number
const CAT_FIELDS = ["Month","Name","SSN","Occupation","Type_of_Loan",
                    "Credit_Mix","Payment_of_Min_Amount","Payment_Behaviour"];

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  resultBox.style.display = 'none';

  const entries = Object.fromEntries(new FormData(form).entries());

  // Убираем пустые и правильно приводим числа — но НЕ для CAT_FIELDS
  for (const k of Object.keys(entries)) {
    const v = entries[k];
    if (v === "") {
      delete entries[k];
      continue;
    }
    if (CAT_FIELDS.includes(k)) {
      // оставляем как строку
      entries[k] = String(v);
      continue;
    }
    // иначе пытаемся превратить в число, если это похоже на число
    if (!isNaN(v) && v.trim() !== "") {
      entries[k] = Number(v);
    } else {
      // оставляем строку (на случай текста)
      entries[k] = v;
    }
  }

  try {
    const resp = await fetch(BACKEND, {
      method: "POST",
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(entries)
    });
    const json = await resp.json();
    if (!resp.ok) throw new Error(JSON.stringify(json));

    let cls = (json.prediction || "").toLowerCase();
    let clsCss = cls.includes("poor") ? "danger" : cls.includes("standard") ? "warn" : "ok";
    resultBox.className = clsCss;
    resultBox.style.display = "block";
    resultBox.innerHTML = `<strong>${json.message}</strong>`;
  } catch (err) {
    resultBox.style.display = "block";
    resultBox.className = "danger";
    resultBox.innerText = "Ошибка: " + err;
  }
});
</script>
</body>
</html>
